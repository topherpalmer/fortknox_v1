{"ast":null,"code":"import { StorageAction } from '@aws-amplify/core/internals/utils';\nimport '@smithy/md5-js';\nimport '@aws-amplify/core/internals/aws-client-utils';\nimport '../../utils/client/runtime/s3TransferHandler/fetch.mjs';\nimport 'fast-xml-parser';\nimport '../../utils/client/runtime/s3TransferHandler/xhr.mjs';\nimport 'buffer';\nimport { resolveS3ConfigAndInput } from '../../utils/resolveS3ConfigAndInput.mjs';\nimport '../../../../errors/types/validation.mjs';\nimport { logger } from '../../../../utils/logger.mjs';\nimport { STORAGE_INPUT_PREFIX } from '../../utils/constants.mjs';\nimport { validateStorageOperationInputWithPrefix } from '../../utils/validateStorageOperationInputWithPrefix.mjs';\nimport '../../utils/client/base.mjs';\nimport '../../utils/client/getObject.mjs';\nimport { listObjectsV2 } from '../../utils/client/listObjectsV2.mjs';\nimport '../../utils/client/putObject.mjs';\nimport '../../utils/client/createMultipartUpload.mjs';\nimport '../../utils/client/uploadPart.mjs';\nimport '../../utils/client/completeMultipartUpload.mjs';\nimport '../../utils/client/listParts.mjs';\nimport '../../utils/client/abortMultipartUpload.mjs';\nimport '../../utils/client/copyObject.mjs';\nimport '../../utils/client/headObject.mjs';\nimport '../../utils/client/deleteObject.mjs';\nimport { getStorageUserAgentValue } from '../../utils/userAgent.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nconst MAX_PAGE_SIZE = 1000;\nconst list = async (amplify, input) => {\n  const {\n    options = {}\n  } = input;\n  const {\n    s3Config,\n    bucket,\n    keyPrefix: generatedPrefix,\n    identityId\n  } = await resolveS3ConfigAndInput(amplify, options);\n  const {\n    inputType,\n    objectKey\n  } = validateStorageOperationInputWithPrefix(input, identityId);\n  const isInputWithPrefix = inputType === STORAGE_INPUT_PREFIX;\n  // @ts-expect-error pageSize and nextToken should not coexist with listAll\n  if (options?.listAll && (options?.pageSize || options?.nextToken)) {\n    const anyOptions = options;\n    logger.debug(`listAll is set to true, ignoring ${anyOptions?.pageSize ? `pageSize: ${anyOptions?.pageSize}` : ''} ${anyOptions?.nextToken ? `nextToken: ${anyOptions?.nextToken}` : ''}.`);\n  }\n  const listParams = {\n    Bucket: bucket,\n    Prefix: isInputWithPrefix ? `${generatedPrefix}${objectKey}` : objectKey,\n    MaxKeys: options?.listAll ? undefined : options?.pageSize,\n    ContinuationToken: options?.listAll ? undefined : options?.nextToken\n  };\n  logger.debug(`listing items from \"${listParams.Prefix}\"`);\n  const listInputArgs = {\n    s3Config,\n    listParams\n  };\n  if (options.listAll) {\n    if (isInputWithPrefix) {\n      return _listAllWithPrefix({\n        ...listInputArgs,\n        generatedPrefix\n      });\n    } else {\n      return _listAllWithPath(listInputArgs);\n    }\n  } else {\n    if (isInputWithPrefix) {\n      return _listWithPrefix({\n        ...listInputArgs,\n        generatedPrefix\n      });\n    } else {\n      return _listWithPath(listInputArgs);\n    }\n  }\n};\n/** @deprecated Use {@link _listAllWithPath} instead. */\nconst _listAllWithPrefix = async ({\n  s3Config,\n  listParams,\n  generatedPrefix\n}) => {\n  const listResult = [];\n  let continuationToken = listParams.ContinuationToken;\n  do {\n    const {\n      items: pageResults,\n      nextToken: pageNextToken\n    } = await _listWithPrefix({\n      generatedPrefix,\n      s3Config,\n      listParams: {\n        ...listParams,\n        ContinuationToken: continuationToken,\n        MaxKeys: MAX_PAGE_SIZE\n      }\n    });\n    listResult.push(...pageResults);\n    continuationToken = pageNextToken;\n  } while (continuationToken);\n  return {\n    items: listResult\n  };\n};\n/** @deprecated Use {@link _listWithPath} instead. */\nconst _listWithPrefix = async ({\n  s3Config,\n  listParams,\n  generatedPrefix\n}) => {\n  const listParamsClone = {\n    ...listParams\n  };\n  if (!listParamsClone.MaxKeys || listParamsClone.MaxKeys > MAX_PAGE_SIZE) {\n    logger.debug(`defaulting pageSize to ${MAX_PAGE_SIZE}.`);\n    listParamsClone.MaxKeys = MAX_PAGE_SIZE;\n  }\n  const response = await listObjectsV2({\n    ...s3Config,\n    userAgentValue: getStorageUserAgentValue(StorageAction.List)\n  }, listParamsClone);\n  if (!response?.Contents) {\n    return {\n      items: []\n    };\n  }\n  return {\n    items: response.Contents.map(item => ({\n      key: generatedPrefix ? item.Key.substring(generatedPrefix.length) : item.Key,\n      eTag: item.ETag,\n      lastModified: item.LastModified,\n      size: item.Size\n    })),\n    nextToken: response.NextContinuationToken\n  };\n};\nconst _listAllWithPath = async ({\n  s3Config,\n  listParams\n}) => {\n  const listResult = [];\n  let continuationToken = listParams.ContinuationToken;\n  do {\n    const {\n      items: pageResults,\n      nextToken: pageNextToken\n    } = await _listWithPath({\n      s3Config,\n      listParams: {\n        ...listParams,\n        ContinuationToken: continuationToken,\n        MaxKeys: MAX_PAGE_SIZE\n      }\n    });\n    listResult.push(...pageResults);\n    continuationToken = pageNextToken;\n  } while (continuationToken);\n  return {\n    items: listResult\n  };\n};\nconst _listWithPath = async ({\n  s3Config,\n  listParams\n}) => {\n  const listParamsClone = {\n    ...listParams\n  };\n  if (!listParamsClone.MaxKeys || listParamsClone.MaxKeys > MAX_PAGE_SIZE) {\n    logger.debug(`defaulting pageSize to ${MAX_PAGE_SIZE}.`);\n    listParamsClone.MaxKeys = MAX_PAGE_SIZE;\n  }\n  const response = await listObjectsV2({\n    ...s3Config,\n    userAgentValue: getStorageUserAgentValue(StorageAction.List)\n  }, listParamsClone);\n  if (!response?.Contents) {\n    return {\n      items: []\n    };\n  }\n  return {\n    items: response.Contents.map(item => ({\n      path: item.Key,\n      eTag: item.ETag,\n      lastModified: item.LastModified,\n      size: item.Size\n    })),\n    nextToken: response.NextContinuationToken\n  };\n};\nexport { list };","map":{"version":3,"names":["MAX_PAGE_SIZE","list","amplify","input","options","s3Config","bucket","keyPrefix","generatedPrefix","identityId","resolveS3ConfigAndInput","inputType","objectKey","validateStorageOperationInputWithPrefix","isInputWithPrefix","STORAGE_INPUT_PREFIX","listAll","pageSize","nextToken","anyOptions","logger","debug","listParams","Bucket","Prefix","MaxKeys","undefined","ContinuationToken","listInputArgs","_listAllWithPrefix","_listAllWithPath","_listWithPrefix","_listWithPath","listResult","continuationToken","items","pageResults","pageNextToken","push","listParamsClone","response","listObjectsV2","userAgentValue","getStorageUserAgentValue","StorageAction","List","Contents","map","item","key","Key","substring","length","eTag","ETag","lastModified","LastModified","size","Size","NextContinuationToken","path"],"sources":["/Users/cp/Documents/Documents - Christopherâ€™s MacBook Air/Development/React/fortknox_v1/node_modules/@aws-amplify/storage/src/providers/s3/apis/internal/list.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { StorageAction } from '@aws-amplify/core/internals/utils';\nimport { resolveS3ConfigAndInput, validateStorageOperationInputWithPrefix, } from '../../utils';\nimport { listObjectsV2, } from '../../utils/client';\nimport { getStorageUserAgentValue } from '../../utils/userAgent';\nimport { logger } from '../../../../utils';\nimport { STORAGE_INPUT_PREFIX } from '../../utils/constants';\nconst MAX_PAGE_SIZE = 1000;\nexport const list = async (amplify, input) => {\n    const { options = {} } = input;\n    const { s3Config, bucket, keyPrefix: generatedPrefix, identityId, } = await resolveS3ConfigAndInput(amplify, options);\n    const { inputType, objectKey } = validateStorageOperationInputWithPrefix(input, identityId);\n    const isInputWithPrefix = inputType === STORAGE_INPUT_PREFIX;\n    // @ts-expect-error pageSize and nextToken should not coexist with listAll\n    if (options?.listAll && (options?.pageSize || options?.nextToken)) {\n        const anyOptions = options;\n        logger.debug(`listAll is set to true, ignoring ${anyOptions?.pageSize ? `pageSize: ${anyOptions?.pageSize}` : ''} ${anyOptions?.nextToken ? `nextToken: ${anyOptions?.nextToken}` : ''}.`);\n    }\n    const listParams = {\n        Bucket: bucket,\n        Prefix: isInputWithPrefix ? `${generatedPrefix}${objectKey}` : objectKey,\n        MaxKeys: options?.listAll ? undefined : options?.pageSize,\n        ContinuationToken: options?.listAll ? undefined : options?.nextToken,\n    };\n    logger.debug(`listing items from \"${listParams.Prefix}\"`);\n    const listInputArgs = {\n        s3Config,\n        listParams,\n    };\n    if (options.listAll) {\n        if (isInputWithPrefix) {\n            return _listAllWithPrefix({\n                ...listInputArgs,\n                generatedPrefix,\n            });\n        }\n        else {\n            return _listAllWithPath(listInputArgs);\n        }\n    }\n    else {\n        if (isInputWithPrefix) {\n            return _listWithPrefix({ ...listInputArgs, generatedPrefix });\n        }\n        else {\n            return _listWithPath(listInputArgs);\n        }\n    }\n};\n/** @deprecated Use {@link _listAllWithPath} instead. */\nconst _listAllWithPrefix = async ({ s3Config, listParams, generatedPrefix, }) => {\n    const listResult = [];\n    let continuationToken = listParams.ContinuationToken;\n    do {\n        const { items: pageResults, nextToken: pageNextToken } = await _listWithPrefix({\n            generatedPrefix,\n            s3Config,\n            listParams: {\n                ...listParams,\n                ContinuationToken: continuationToken,\n                MaxKeys: MAX_PAGE_SIZE,\n            },\n        });\n        listResult.push(...pageResults);\n        continuationToken = pageNextToken;\n    } while (continuationToken);\n    return {\n        items: listResult,\n    };\n};\n/** @deprecated Use {@link _listWithPath} instead. */\nconst _listWithPrefix = async ({ s3Config, listParams, generatedPrefix, }) => {\n    const listParamsClone = { ...listParams };\n    if (!listParamsClone.MaxKeys || listParamsClone.MaxKeys > MAX_PAGE_SIZE) {\n        logger.debug(`defaulting pageSize to ${MAX_PAGE_SIZE}.`);\n        listParamsClone.MaxKeys = MAX_PAGE_SIZE;\n    }\n    const response = await listObjectsV2({\n        ...s3Config,\n        userAgentValue: getStorageUserAgentValue(StorageAction.List),\n    }, listParamsClone);\n    if (!response?.Contents) {\n        return {\n            items: [],\n        };\n    }\n    return {\n        items: response.Contents.map(item => ({\n            key: generatedPrefix\n                ? item.Key.substring(generatedPrefix.length)\n                : item.Key,\n            eTag: item.ETag,\n            lastModified: item.LastModified,\n            size: item.Size,\n        })),\n        nextToken: response.NextContinuationToken,\n    };\n};\nconst _listAllWithPath = async ({ s3Config, listParams, }) => {\n    const listResult = [];\n    let continuationToken = listParams.ContinuationToken;\n    do {\n        const { items: pageResults, nextToken: pageNextToken } = await _listWithPath({\n            s3Config,\n            listParams: {\n                ...listParams,\n                ContinuationToken: continuationToken,\n                MaxKeys: MAX_PAGE_SIZE,\n            },\n        });\n        listResult.push(...pageResults);\n        continuationToken = pageNextToken;\n    } while (continuationToken);\n    return {\n        items: listResult,\n    };\n};\nconst _listWithPath = async ({ s3Config, listParams, }) => {\n    const listParamsClone = { ...listParams };\n    if (!listParamsClone.MaxKeys || listParamsClone.MaxKeys > MAX_PAGE_SIZE) {\n        logger.debug(`defaulting pageSize to ${MAX_PAGE_SIZE}.`);\n        listParamsClone.MaxKeys = MAX_PAGE_SIZE;\n    }\n    const response = await listObjectsV2({\n        ...s3Config,\n        userAgentValue: getStorageUserAgentValue(StorageAction.List),\n    }, listParamsClone);\n    if (!response?.Contents) {\n        return {\n            items: [],\n        };\n    }\n    return {\n        items: response.Contents.map(item => ({\n            path: item.Key,\n            eTag: item.ETag,\n            lastModified: item.LastModified,\n            size: item.Size,\n        })),\n        nextToken: response.NextContinuationToken,\n    };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}